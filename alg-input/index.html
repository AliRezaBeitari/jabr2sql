<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Alg Input</title>
    <link rel="stylesheet" href="https://ianlucas.github.io/mje/mje.css">
    <link rel="stylesheet" href="https://ianlucas.github.io/mje/styles.css">
    <style>
        .buttons {
            margin-bottom: 50px;
        }

        .buttons button {
            font-family: MJXc-TeX-math-I, MJXc-TeX-math-Ix, MJXc-TeX-math-Iw;
            font-size: 30px;
            padding: 10px 15px 10px 15px;
            margin-right: 20px;
        }
    </style>
</head>
<body>
    <div class="buttons">
        <button onclick="func('σ');">σ</button>
        <button onclick="func('Π');">Π</button>
        <button onclick="func2('∪');">∪</button>
        <button onclick="func2('∩');">∩</button>
        <button onclick="func2('×');">×</button>
        <button onclick="func('×');">×<sub>θ</sub></button>
        <button onclick="func2('÷');">÷</button>
        <button onclick="func2('←');">←</button>
        <button onclick="func2('-');">-</button>
        <button onclick="func2('∞');">∞</button>
        <button onclick="func2('∝');">∝</button>
        <button onclick="func3('ρ');">ρ</button>
		<button onclick="run();">RUN</button>
    </div>

    <section id="equation-wrapper">
        <div id="myEquation"></div>
    </section>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.6.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML"></script>
    <script src="https://ianlucas.github.io/mje/mje.js"></script>
	<script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>

    <script>
        window.editor = mje('#myEquation');
        window.editor.set('<math><msub><mrow><mi>Π</mi></mrow><mrow><mi>a</mi><mo>,</mo><mi>b</mi></mrow></msub><mo>(</mo><mi>s</mi><mi>t</mi><mi>u</mi><mi>d</mi><mo>)</mo></math>');
        
        function func(inp) {
            editor.sub();
            editor.identifier(inp);
        }

        function func2(inp) {
            editor.identifier(inp);
        }

        function func3(inp) {
            editor.subsup();
            editor.identifier(inp);
        }
		
		function recursivelyParse(element) {
			var res = "";
			var functionIsOpen = false;
			var lastWasId = false;

			element.children().each(function (i, el) {
				switch (el.name) {
					case "mo":
					case "mi":
					case "mn":
						var _id = $(el).text();

						if (functionIsOpen && _id == "(") {
							functionIsOpen = false;
							// res += '"';
							// lastWasId = false;
						}
						else {
							/*if (_id == ")" && lastWasId) {
								res += '"';
							}*/

							res += _id;
							lastWasId = true;
						}

						break;

					case "msub":
						var func = recursivelyParse($(el).children().first());
						var inner = recursivelyParse($(el).children().last());

						console.log("function: " + func);
						console.log("params: " + inner);
						console.log("-----------------------");

						functionIsOpen = true;
						
						if (func == "Π") {
							inner = inner.split(",").map(p => '"' + p + '"').join(", ");
							res += func + "([" + inner + "], ";
						}
						else if (func == "σ") {
							res += func + "(\"" + inner + "\", ";
						}

						break;
				}
			});

			return res.trim();
		}
		
		function run() {
			var result = "";			
			var input = editor.get();
			var root = $($.parseHTML(input));
			
			console.log(root);
			
			result = recursivelyParse(root);
			result = result.replace(/\(([^Πσ]+), (\w+)\)/g, '($1, "$2")');
			
			// alert(result);
		}
    </script>
</body>
</html>